import React,{useState,useEffect}from"react";import InputField from"../InputField.js";import QuillEditor from"../QuillEditor.js";import{inputValidation}from"../../../../scripts/inputValidation.js";import{showNotification}from"../showNotification.js";import Switch from"../ToggleSwitch.js";import Technologies from"./Technologies.js";import ExternalLinks from"./ExternalLinks.js";export default function ProjectForm({update:e=!1,csrf_token:t,project:n={name:"",slug:"",isVisible:!1,content:"",links:[],technologies:[]}}){const[l,i]=useState({name:null,slug:null,content:null,technologies:null}),[a,s]=useState(!1),[o,c]=useState(!0),[r,m]=useState({name:n.name,slug:n.slug,isVisible:n.isVisible,content:n.content,links:n.links,technologies:n.technologies});let u=null;useEffect(()=>{const e=e=>{o||(e.preventDefault(),e.returnValue=!0)};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[o]),useEffect(()=>{const e=document.getElementById("saveBtn");return u=document.getElementById("editBtn"),e&&e.addEventListener("click",E),u&&u.addEventListener("click",v),()=>{e&&e.removeEventListener("click",E),u&&u.removeEventListener("click",v)}},[r]);const d=e=>{e=e.trimLeft(),i({...l,name:inputValidation.checkLength(e,60),slug:null}),m({...r,name:e,slug:inputValidation.string_to_slug(e)}),c(!1)},g=e=>{e=inputValidation.string_to_slug(e),i({...l,slug:inputValidation.checkLength(e,100)}),m({...r,slug:e}),c(!1)},h=e=>{m({...r,isVisible:e}),c(!1)},f=e=>{m({...r,content:e}),c(!1)},p=e=>{i({...l,technologies:null}),m({...r,technologies:e})},b=e=>{m({...r,links:e})},v=e=>E(e,!0),E=async(a,o=!1)=>{a.preventDefault();const m=inputValidation.checkLength(r.name.trim(),60),d=inputValidation.checkLength(r.slug,100),g=0===r.content.length?"Le contenu ne doit pas être vide":null,h=0===r.technologies.length||null;i({...l,name:m,slug:d,content:g,technologies:h}),m||d||g||h||(c(!0),saveBtn.disabled=!0,u&&(u.disabled=!0),s(!0),await fetch(`/admin/project/${e?n.id:"create"}`,{method:"POST",body:JSON.stringify({isVisible:r.isVisible,name:r.name,slug:r.slug,content:r.content,links:r.links,technologies:r.technologies,csrf_token:t})}).then(e=>e.json()).then(e=>e.success?o?void window.location.reload():void(document.location.href="/admin/project/"):(s(!1),saveBtn.disabled=!1,c(!1),u&&(u.disabled=!1),showNotification(e.error))).catch(e=>{showNotification("erreur : "+e),s(!1),saveBtn.disabled=!1,c(!1),u&&(u.disabled=!1)}))};return React.createElement("div",{className:"font-eudoxus flex flex-col gap-4"},React.createElement("div",{className:"flex gap-2 max-sm:flex-col-reverse justify-between"},React.createElement("label",{className:"flex flex-col gap-2 justify-start w-fit",htmlFor:"visible"},"visible",React.createElement(Switch,{name:"visible",id:"visible",label:"visible",className:"mt-1",onChange:h,checked:r.isVisible,disabled:a}))," ",React.createElement("a",{target:"_blank",ariaLabel:"aperçu de la page",href:"/projets/"+r.slug,className:"mr-2 hover:text-white transition-colors duration-150 max-sm:text-right"},"aperçu de la page")),React.createElement("div",{className:"flex gap-4 max-sm:flex-col"},React.createElement(InputField,{label:"nom",id:"name",className:"max-w-80",error:l.name,onChange:d,value:r.name,disabled:a}),React.createElement(InputField,{label:"slug",id:"slug",className:"max-w-80",error:l.slug,onChange:g,value:r.slug,disabled:a})),React.createElement(Technologies,{error:l.technologies,selectedTechnologies:r.technologies,onChange:p,value:r.technologies}),React.createElement("div",null,React.createElement("label",{htmlFor:"container",className:"flex flex-col gap-2 mb-2 w-full text-sm font-medium"},"article"),React.createElement(QuillEditor,{disabled:a,onChange:f,value:r.content}),l.content&&React.createElement("small",{className:"text-red"},l.content)),React.createElement(ExternalLinks,{selectedLinks:r.links,onChange:b,value:r.links}))}