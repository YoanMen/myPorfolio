import React,{useState,useEffect}from"react";import InputField from"../InputField.js";import TextAreaField from"../TextAreaField.js";import{inputValidation}from"../../../../scripts/inputValidation.js";import{showNotification}from"../showNotification.js";import Switch from"../ToggleSwitch.js";export default function IconForm({update:e=!1,csrf_token:t,icon:n={name:"",svg:"",isTechnology:!1}}){const[a,o]=useState({name:null,svg:null}),[i,s]=useState(!1),[c,l]=useState(!0),[r,m]=useState({name:n.name,svg:n.svg,isTechnology:n.isTechnology});useEffect(()=>{const e=e=>{c||(e.preventDefault(),e.returnValue=!0)};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[c]),useEffect(()=>{const e=document.getElementById("saveBtn");return e&&e.addEventListener("click",d),()=>{e&&e.removeEventListener("click",d)}},[r]);const d=async i=>{i.preventDefault();const c=inputValidation.checkLength(r.name.trim(),60),m=inputValidation.checkIsSVG(r.svg.trim());o({...a,name:c,svg:m}),c||m||(l(!0),saveBtn.disabled=!0,s(!0),await fetch(`/admin/icon/${e?n.id:"create"}`,{method:"POST",body:JSON.stringify({name:r.name,svg:r.svg,isTechnology:r.isTechnology,csrf_token:t})}).then(e=>e.json()).then(e=>{if(!e.success)return s(!1),saveBtn.disabled=!1,l(!1),showNotification(e.error);document.location.href="/admin/icon/"}).catch(e=>{showNotification("erreur : "+e),s(!1),l(!1),saveBtn.disabled=!1}))},u=e=>{o({...a,name:inputValidation.checkLength(e,60)}),m({...r,name:e}),l(!1)},g=e=>{e=e.trim(),o({...a,svg:inputValidation.checkIsSVG(e)}),m({...r,svg:e}),l(!1)},f=e=>{m({...r,isTechnology:e}),l(!1)};return React.createElement("div",{className:"font-eudoxus flex flex-col gap-4"},React.createElement("div",{className:"flex gap-4 max-sm:flex-col-reverse"},React.createElement(InputField,{label:"nom",id:"name",className:"max-w-80",error:a.name,onChange:u,value:r.name,disabled:i}),React.createElement("label",{className:"flex flex-col gap-2 justify-start",htmlFor:"technologie"},"technologie",!e&&React.createElement(Switch,{name:"technologie",id:"technologie",label:"technologie",className:"mt-1",onChange:f,checked:r.isTechnology,disabled:i}))),React.createElement(TextAreaField,{label:"SVG",id:"svg",error:a.svg,onChange:g,value:r.svg,disabled:i}))}